package org.opensmartgridplatform.adapter.protocol.dlms.domain.commands.stub;

import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.openmuc.jdlms.AccessResultCode;
import org.openmuc.jdlms.AttributeAddress;
import org.openmuc.jdlms.DlmsConnection;
import org.openmuc.jdlms.GetResult;
import org.openmuc.jdlms.MethodParameter;
import org.openmuc.jdlms.MethodResult;
import org.openmuc.jdlms.SetParameter;
import org.openmuc.jdlms.datatypes.DataObject;
import org.opensmartgridplatform.adapter.protocol.dlms.domain.commands.testutil.GetResultImpl;

public class DlmsConnectionStub implements DlmsConnection {

    private List<AttributeAddress> requestedAttributeAddresses = new ArrayList<>();

    private final Map<String, DataObject> returnValues = new HashMap<>();
    private DataObject defaultReturnValue = DataObject.newNullData();

    private boolean closeCalled = false;

    @Override
    public List<GetResult> get(final List<AttributeAddress> params) {

        this.requestedAttributeAddresses.addAll(params);

        final List<GetResult> results = new ArrayList<>();

        for (final AttributeAddress attributeAddress : params) {
            results.add(this.get(attributeAddress));
        }

        return results;
    }

    @Override
    public GetResult get(final AttributeAddress var1) {

        this.requestedAttributeAddresses.addAll(Collections.singletonList(var1));

        if (this.returnValues.containsKey(var1.toString())) {
            return new GetResultImpl(this.returnValues.get(var1.toString()), AccessResultCode.SUCCESS);
        } else {
            return new GetResultImpl(this.defaultReturnValue, AccessResultCode.SUCCESS);
        }
    }

    @Override
    public GetResult get(final boolean var1, final AttributeAddress var2) {
        return null;
    }

    @Override
    public List<GetResult> get(final boolean var1, final List<AttributeAddress> var2) {
        return null;
    }

    @Override
    public List<AccessResultCode> set(final List<SetParameter> var1) {
        return null;
    }

    @Override
    public List<AccessResultCode> set(final boolean var1, final List<SetParameter> var2) {
        return null;
    }

    @Override
    public AccessResultCode set(final boolean var1, final SetParameter var2) {
        return null;
    }

    @Override
    public AccessResultCode set(final SetParameter var1) {
        return null;
    }

    @Override
    public MethodResult action(final boolean var1, final MethodParameter var2) {
        return null;
    }

    @Override
    public MethodResult action(final MethodParameter var1) {
        return null;
    }

    @Override
    public List<MethodResult> action(final List<MethodParameter> var1) {
        return null;
    }

    @Override
    public List<MethodResult> action(final boolean var1, final List<MethodParameter> var2) {
        return null;
    }

    @Override
    public void changeClientGlobalAuthenticationKey(final byte[] var1) {

    }

    @Override
    public void changeClientGlobalEncryptionKey(final byte[] var1) {

    }

    @Override
    public void disconnect() {

    }

    @Override
    public void close() {
        this.closeCalled = true;
    }

    public List<AttributeAddress> getRequestedAttributeAddresses() {
        return this.requestedAttributeAddresses;
    }

    public void clearRequestedAttributeAddresses() {
        this.requestedAttributeAddresses = new ArrayList<>();
    }

    public void addReturnValue(final AttributeAddress attributeAddress, final DataObject dataObject) {
        this.returnValues.put(attributeAddress.toString(), dataObject);
    }

    public void setDefaultReturnValue(final DataObject dataObject) {
        this.defaultReturnValue = dataObject;
    }

    public boolean isCloseCalled() {
        return this.closeCalled;
    }
}
